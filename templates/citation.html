<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <script src="https://use.fontawesome.com/e63904aba2.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Cormorant+Garamond:400,400italic,700,700italic" rel="stylesheet"
    type="text/css" />
  <title>UQ Assessment Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="static/title.css" />
  <link rel="stylesheet" type="text/css" href="static/loading.css" />
  <link rel="stylesheet" type="text/css" href="static/loading-btn.css" />
  <link rel="stylesheet/less" type="text/css" href="static/button.less" />
  <link rel="icon" href="images/favicon.ico" type="image/x-icon" />
  <link href="https://fonts.googleapis.com/css?family=Muli%7CRoboto:400,300,500,700,900" rel="stylesheet" />
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="shortcut icon" type="image/png" href="/static/logo2.png" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/3.9.0/less.min.js" type="text/javascript"></script>
  <meta name="google-site-verification" content="E4Tnw9z5jgtsciXeTXMlR_hLhPJrROzxw5nl0sFkSAY" />
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" />
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-7693026522017814",
      enable_page_level_ads: true
    });
  </script>
</head>

<body>
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <h1>UQ Assessment Planner</h1>
  <main>
    <!-- For google adsense -->
    <p style="display: none">
      UQ Assessment Planner is a great tool for students to use to organise
      their assessment at the beginning of each semester. UQ Assessment
      Planner is a great tool for students to use to organise their assessment
      at the beginning of each semester. UQ Assessment Planner is a great tool
      for students to use to organise their assessment at the beginning of
      each semester. UQ Assessment Planner is a great tool for students to use
      to organise their assessment at the beginning of each semester. UQ
      Assessment Planner is a great tool for students to use to organise their
      assessment at the beginning of each semester. UQ Assessment Planner is a
      great tool for students to use to organise their assessment at the
      beginning of each semester. UQ Assessment Planner is a great tool for
      students to use to organise their assessment at the beginning of each
      semester. UQ Assessment Planner is a great tool for students to use to
      organise their assessment at the beginning of each semester. UQ
      Assessment Planner is a great tool for students to use to organise their
      assessment at the beginning of each semester.
    </p>
    <div id="citation">
      <div class="tab">
        <button class="tablinks active" onclick="changeTab(event, 'by-course')">
          By Course
        </button>
        <button class="tablinks" onclick="changeTab(event, 'chronological')">
          Chronological
        </button>
      </div>

      <div id="by-course" class="tabcontent">
        {{ by_course_as_html | safe }}
      </div>

      <div id="chronological" class="tabcontent">
        <p>
          NOTE: Assessment items without a specific due date on the ECP will
          not appear here
        </p>
        <div style="overflow-x:auto;">
          <table>
            <tr>
              <th>Assessment Task</th>
              <th>Due Date</th>
              <th>Weighting</th>
              <th>Learning Objective</th>
            </tr>
            {{
                chronological_html | safe
              }}
          </table>
        </div>
      </div>

      <p style="display: none">
        UQ Assessment Planner is a great tool for students to use to organise
        their assessment at the beginning of each semester. UQ Assessment
        Planner is a great tool for students to use to organise their
        assessment at the beginning of each semester. UQ Assessment Planner is
        a great tool for students to use to organise their assessment at the
        beginning of each semester. UQ Assessment Planner is a great tool for
        students to use to organise their assessment at the beginning of each
        semester. UQ Assessment Planner is a great tool for students to use to
        organise their assessment at the beginning of each semester. UQ
        Assessment Planner is a great tool for students to use to organise
        their assessment at the beginning of each semester. UQ Assessment
        Planner is a great tool for students to use to organise their
        assessment at the beginning of each semester. UQ Assessment Planner is
        a great tool for students to use to organise their assessment at the
        beginning of each semester. UQ Assessment Planner is a great tool for
        students to use to organise their assessment at the beginning of each
        semester.
      </p>

      <form id="export-form">
        <!-- <button class="button arrow"> -->
        <button class="export-button" target="_blank">
          <div class="btn btn-default ld-ext-right button arrow">
            Export to Google Calendar
            <div class="ld ld-ball ld-flip"></div>
          </div>
        </button>
      </form>
      <br />
      <div class="success-message-div">
        <p>
          NOTE: Assessment items without a specific due date on the ECP will
          not appear on your calendar
        </p>
      </div>
      <br />
      <br />
    </div>
    <footer class="footer">
      <div>Not affiliated with UQ.</div>
      <div>
        &copy; 2018
        <a href="https://github.com/max-quirk" target="_blank" rel="noopener">Max Quirk</a>
        |
        <a href="/privacy">Privacy Policy</a>
      </div>
    </footer>
  </main>
  <script src="static/correct.js"></script>

  <script>
    let canRequestExport = true;
    const connectOauth = (redirect_url) => {
      if (!canRequestExport) return
      const oauthWindow = window.open(redirect_url);
      const checkForClose = () => {
        if (!oauthWindow.closed) return setTimeout(checkForClose, 250);

        canRequestExport = false;
        return requestExport();
      };

      return checkForClose();
    }

    const requestExport = () => {
      return $.ajax({
        url: "/export",
        method: "POST",
        data: (window.state || {}).assessments
      }).done(function (data) {
        if (data.redirect_url) {
          return connectOauth(data.redirect_url)
        }

        canRequestExport = true;

        if (data.success) {
          $(".ld-ext-right").removeClass("running");
          $(".ld-ext-right").addClass("success-button");
          $(".ld-ext-right").html("Success &nbsp &nbsp &#10004");
          $(".export-button").attr("disabled", "disabled");
          $(".success-message-div").css("display", "block");
        }
      });
    };

    $("#export-form").on("submit", function (e) {
      e.preventDefault();
      console.log("exporting");
      $(".ld-ext-right").addClass("running");
      $(".button").addClass("after-gone");
      return requestExport();
    });

  </script>
  <script type=text/javascript> window.state={{ state|tojson }}; </script> </body> </html>
